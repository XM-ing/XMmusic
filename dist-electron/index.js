"use strict";const i=require("electron"),d=require("path"),p=require("node:net"),h=require("node:os");class l extends Error{constructor(r){super(`${r} is locked`)}}const a={old:new Set,young:new Set},m=1e3*15;let c;const b=()=>{const e=h.networkInterfaces(),r=new Set([void 0,"0.0.0.0"]);for(const s of Object.values(e))for(const o of s)r.add(o.address);return r},u=e=>new Promise((r,s)=>{const o=p.createServer();o.unref(),o.on("error",s),o.listen(e,()=>{const{port:n}=o.address();o.close(()=>{r(n)})})}),f=async(e,r)=>{if(e.host||e.port===0)return u(e);for(const s of r)try{await u({port:e.port,host:s})}catch(o){if(!["EADDRNOTAVAIL","EINVAL"].includes(o.code))throw o}return e.port},y=function*(e){e&&(yield*e),yield 0};async function g(e){let r,s=new Set;if(e.port&&(r=typeof e.port=="number"?[e.port]:e.port),e.exclude){const n=e.exclude;if(typeof n[Symbol.iterator]!="function")throw new TypeError("The `exclude` option must be an iterable.");for(const t of n){if(typeof t!="number")throw new TypeError("Each item in the `exclude` option must be a number corresponding to the port you want excluded.");if(!Number.isSafeInteger(t))throw new TypeError(`Number ${t} in the exclude option is not a safe integer and can't be used`)}s=new Set(n)}c===void 0&&(c=setTimeout(()=>{c=void 0,a.old=a.young,a.young=new Set},m),c.unref&&c.unref());const o=b();for(const n of y(r))try{if(s.has(n))continue;let t=await f({...e,port:n},o);for(;a.old.has(t)||a.young.has(t);){if(n!==0)throw new l(n);t=await f({...e,port:n},o)}return a.young.add(t),t}catch(t){if(!["EADDRINUSE","EACCES"].includes(t.code)&&!(t instanceof l))throw t}throw new Error("No available ports found")}function v(e,r){if(!Number.isInteger(e)||!Number.isInteger(r))throw new TypeError("`from` and `to` must be integer numbers");return function*(o,n){for(let t=o;t<=n;t++)yield t}(e,r)}const{startServer:x,stopServer:E}=require(d.join(__dirname,"./server/server.js"));function S(e){i.ipcMain.on("min-window",()=>e.minimize()),i.ipcMain.on("close-window",()=>e.close()),i.ipcMain.handle("is-maximized",()=>e.isMaximized()),i.ipcMain.handle("max-window",()=>e.maximize()),i.ipcMain.handle("unmax-window",()=>e.unmaximize())}const w=()=>{const e=new i.BrowserWindow({autoHideMenuBar:!0,width:1200,height:800,minWidth:1200,minHeight:800,frame:!1,webPreferences:{contextIsolation:!0,nodeIntegration:!0,preload:d.join(__dirname,"./preload.js")}});process.env.NODE_ENV!=="development"?(e.loadFile(d.join(__dirname,"./index.html")),e.webContents.openDevTools()):(e.loadURL("http://localhost:5173"),e.webContents.openDevTools()),S(e)};i.app.whenReady().then(async()=>{const e=await g({port:v(3e3,3100)});await x(e),w(),i.app.on("activate",()=>{i.BrowserWindow.getAllWindows().length===0&&w()})});i.app.on("window-all-closed",()=>{process.platform!=="darwin"&&(i.app.quit(),E())});
